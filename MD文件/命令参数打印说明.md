# Go Cobra 命令参数打印说明

## 概述
本文档说明如何在 Go Cobra 命令行应用中打印和查看输入的命令参数、标志和选项。

## 实现方法

Examples:
rentpro-admin migrate -c config/settings.yml

Flags:
  -c, --config string   指定配置文件路径 (default "config/settings.yml")
  -d, --domain string   选择租户主机域名 (default "*")
  -g, --generate        生成迁移文件
  -a, --goAdmin         生成 go-admin 框架迁移文件
  -h, --help            help for migrate
  -v, --version         显示版本信息
  
### 1. 基本命令信息获取

在 Cobra 命令的 `Run` 函数中，可以通过以下方式获取命令信息：

```go
Run: func(cmd *cobra.Command, args []string) {
    // 命令名称
    fmt.Printf("命令名称: %s\n", cmd.Name())
    
    // 完整命令路径（包括父命令）
    fmt.Printf("完整命令路径: %s\n", cmd.CommandPath())
    
    // 输入的参数
    fmt.Printf("输入的参数: %v\n", args)
    
    // 参数数量
    fmt.Printf("参数数量: %d\n", len(args))
}
```

### 2. 标志(Flags)信息获取

```go
// 遍历所有已设置的标志
hasFlags := false
cmd.Flags().VisitAll(func(flag *pflag.Flag) {
    if flag.Changed {
        if !hasFlags {
            fmt.Println("\n设置的标志:")
            hasFlags = true
        }
        fmt.Printf("  --%s = %s\n", flag.Name, flag.Value)
    }
})

if !hasFlags {
    fmt.Println("\n没有设置任何标志")
}
```

### 3. 原始命令行参数获取

```go
// 获取完整的原始命令行参数
fmt.Printf("原始命令行参数: %v\n", os.Args)
```

### 4. 获取特定标志的值

```go
// 获取字符串类型标志
email, _ := cmd.Flags().GetString("email")

// 获取整数类型标志
age, _ := cmd.Flags().GetInt("age")

// 获取布尔类型标志
verbose, _ := cmd.Flags().GetBool("verbose")
```

## 使用示例

### 运行示例

1. **基本命令**：
   ```bash
   go run main.go
   ```
   输出：
   ```
   命令名称: rentpro-admin
   完整命令路径: rentpro-admin
   输入的参数: []
   参数数量: 0
   没有设置任何标志
   ```

2. **带参数和标志的子命令**：
   ```bash
   go run main.go user create testuser --email=test@example.com --age=25
   ```
   输出：
   ```
   命令名称: create
   完整命令路径: rentpro-admin user create
   输入的参数: [testuser]
   参数数量: 1
   设置的标志:
     --age = 25
     --email = test@example.com
   ```

3. **全局标志**：
   ```bash
   go run main.go --config=/path/to/config.yml --verbose user
   ```
   输出：
   ```
   命令名称: user
   完整命令路径: rentpro-admin user
   输入的参数: []
   参数数量: 0
   设置的标志:
     --config = /path/to/config.yml
     --verbose = true
   ```

## 实现要点

### 1. 导入必要的包
```go
import (
    "fmt"
    "os"
    "github.com/spf13/cobra"
    "github.com/spf13/pflag"  // 用于标志处理
)
```

### 2. 通用打印函数
创建一个通用的 `printCommandInfo` 函数，可以在多个命令中复用：

```go
func printCommandInfo(cmd *cobra.Command, args []string) {
    fmt.Println("\n=== 命令执行信息 ===")
    fmt.Printf("命令名称: %s\n", cmd.Name())
    fmt.Printf("完整命令路径: %s\n", cmd.CommandPath())
    fmt.Printf("输入的参数: %v\n", args)
    fmt.Printf("参数数量: %d\n", len(args))
    
    // 打印标志信息
    hasFlags := false
    cmd.Flags().VisitAll(func(flag *pflag.Flag) {
        if flag.Changed {
            if !hasFlags {
                fmt.Println("\n设置的标志:")
                hasFlags = true
            }
            fmt.Printf("  --%s = %s\n", flag.Name, flag.Value)
        }
    })
    
    if !hasFlags {
        fmt.Println("\n没有设置任何标志")
    }
    
    fmt.Printf("\n原始命令行参数: %v\n", os.Args)
    fmt.Println("==================")
}
```

### 3. 命令结构设置
```go
var rootCmd = &cobra.Command{
    Use:   "rentpro-admin",
    Short: "Cobra is a CLI library for Go that empowers applications",
    Run: func(cmd *cobra.Command, args []string) {
        printCommandInfo(cmd, args)
    },
}
```

## 调试技巧

1. **在 Execute() 函数中预打印**：
   ```go
   func Execute() {
       fmt.Printf("接收到的命令行参数: %v\n", os.Args)
       if err := rootCmd.Execute(); err != nil {
           // 错误处理
       }
   }
   ```

2. **使用 cobra 的内置调试功能**：
   ```go
   // 设置详细输出
   rootCmd.PersistentFlags().BoolP("verbose", "v", false, "详细输出模式")
   ```

3. **条件打印**：
   ```go
   verbose, _ := cmd.Flags().GetBool("verbose")
   if verbose {
       printCommandInfo(cmd, args)
   }
   ```

## 注意事项

1. `os.Args[0]` 通常是程序的路径，实际的命令参数从 `os.Args[1:]` 开始
2. `flag.Changed` 只有在用户明确设置了标志时才为 `true`
3. 全局标志（PersistentFlags）会在所有子命令中可用
4. 使用 `cobra.MinimumNArgs(n)` 可以确保命令至少接收指定数量的参数

这个实现提供了完整的命令输入信息打印功能，有助于调试和理解用户的输入。