# ä¸ƒç‰›äº‘å›¾ç‰‡å­˜å‚¨æœåŠ¡é€‰è´­æŒ‡å—

**æŒ‡å—æ—¥æœŸï¼š** 2024å¹´12æœˆ
**é€‚ç”¨åœºæ™¯ï¼š** æˆ·å‹å›¾å­˜å‚¨å’Œç®¡ç†
**æ¨èé…ç½®ï¼š** å¯¹è±¡å­˜å‚¨ + å›¾ç‰‡å¤„ç† + CDN

## ğŸ¯ æ¨èè´­ä¹°çš„ä¸ƒç‰›äº‘æœåŠ¡

### 1ï¸âƒ£ **å¯¹è±¡å­˜å‚¨ (Kodo) - æ ¸å¿ƒå¿…é€‰**

#### **æœåŠ¡è¯´æ˜**
- **äº§å“åç§°ï¼š** å¯¹è±¡å­˜å‚¨ Kodo
- **åŠŸèƒ½ï¼š** æ–‡ä»¶å­˜å‚¨ã€ç®¡ç†ã€è®¿é—®
- **é€‚ç”¨ï¼š** æˆ·å‹å›¾ç‰‡ã€æ–‡æ¡£ç­‰é™æ€èµ„æºå­˜å‚¨

#### **å…è´¹é¢åº¦ï¼ˆæ¯æœˆï¼‰**
```
âœ… å­˜å‚¨ç©ºé—´ï¼š10GB
âœ… ä¸‹è½½æµé‡ï¼š10GB  
âœ… PUT/DELETE è¯·æ±‚ï¼š10ä¸‡æ¬¡
âœ… GET è¯·æ±‚ï¼š100ä¸‡æ¬¡
```

#### **ä»˜è´¹æ ‡å‡†ï¼ˆè¶…å‡ºå…è´¹é¢åº¦åï¼‰**
| é¡¹ç›® | ä»·æ ¼ | è¯´æ˜ |
|------|------|------|
| å­˜å‚¨è´¹ç”¨ | 0.148å…ƒ/GB/æœˆ | æ ‡å‡†å­˜å‚¨ |
| ä¸‹è½½æµé‡ | 0.29å…ƒ/GB | å¤–ç½‘ä¸‹è¡Œæµé‡ |
| PUT/DELETEè¯·æ±‚ | 0.01å…ƒ/ä¸‡æ¬¡ | ä¸Šä¼ /åˆ é™¤æ“ä½œ |
| GETè¯·æ±‚ | 0.01å…ƒ/10ä¸‡æ¬¡ | ä¸‹è½½/è®¿é—®æ“ä½œ |

### 2ï¸âƒ£ **æ™ºèƒ½å¤šåª’ä½“æœåŠ¡ (DORA) - å¼ºçƒˆæ¨è**

#### **æœåŠ¡è¯´æ˜**
- **äº§å“åç§°ï¼š** æ™ºèƒ½å¤šåª’ä½“æœåŠ¡ DORA
- **åŠŸèƒ½ï¼š** å›¾ç‰‡å¤„ç†ã€æ ¼å¼è½¬æ¢ã€å‹ç¼©ã€æ°´å°
- **é€‚ç”¨ï¼š** æˆ·å‹å›¾è‡ªåŠ¨ä¼˜åŒ–ã€ç¼©ç•¥å›¾ç”Ÿæˆ

#### **å…è´¹é¢åº¦ï¼ˆæ¯æœˆï¼‰**
```
âœ… å›¾ç‰‡å¤„ç†ï¼š10ä¸‡æ¬¡
âœ… å›¾ç‰‡ç˜¦èº«ï¼š1ä¸‡æ¬¡
âœ… å†…å®¹å®¡æ ¸ï¼š1000æ¬¡
```

#### **ä»˜è´¹æ ‡å‡†**
| åŠŸèƒ½ | ä»·æ ¼ | è¯´æ˜ |
|------|------|------|
| åŸºç¡€å›¾ç‰‡å¤„ç† | 0.025å…ƒ/åƒæ¬¡ | ç¼©æ”¾ã€è£å‰ªã€æ—‹è½¬ç­‰ |
| å›¾ç‰‡æ ¼å¼è½¬æ¢ | 0.025å…ƒ/åƒæ¬¡ | JPG/PNG/WebPè½¬æ¢ |
| å›¾ç‰‡ç˜¦èº« | 0.15å…ƒ/åƒæ¬¡ | æ™ºèƒ½å‹ç¼© |

### 3ï¸âƒ£ **CDN åŠ é€ŸæœåŠ¡ - æ¨èé…ç½®**

#### **æœåŠ¡è¯´æ˜**
- **äº§å“åç§°ï¼š** CDN å†…å®¹åˆ†å‘ç½‘ç»œ
- **åŠŸèƒ½ï¼š** å…¨çƒåŠ é€Ÿè®¿é—®ã€é™ä½å»¶è¿Ÿ
- **é€‚ç”¨ï¼š** æå‡æˆ·å‹å›¾åŠ è½½é€Ÿåº¦

#### **å…è´¹é¢åº¦ï¼ˆæ¯æœˆï¼‰**
```
âœ… CDNæµé‡ï¼š10GB
âœ… HTTPSè¯·æ±‚ï¼š100ä¸‡æ¬¡
```

#### **ä»˜è´¹æ ‡å‡†**
| æµé‡é˜¶æ¢¯ | ä»·æ ¼ | è¯´æ˜ |
|----------|------|------|
| 0-50GB | 0.24å…ƒ/GB | é¦–æ¡£ä»·æ ¼ |
| 50GB-500GB | 0.23å…ƒ/GB | ç¬¬äºŒæ¡£ |
| 500GB-1TB | 0.22å…ƒ/GB | ç¬¬ä¸‰æ¡£ |

## ğŸ’° æˆæœ¬é¢„ä¼°

### ğŸ“Š **å°å‹é¡¹ç›®ï¼ˆæœˆæ´»<1000ç”¨æˆ·ï¼‰**

**é¢„ä¼°ä½¿ç”¨é‡ï¼š**
- å­˜å‚¨ç©ºé—´ï¼š5GBï¼ˆçº¦5000å¼ æˆ·å‹å›¾ï¼‰
- æœˆä¸‹è½½æµé‡ï¼š8GB
- å›¾ç‰‡å¤„ç†ï¼š5ä¸‡æ¬¡/æœˆ
- CDNæµé‡ï¼š8GB

**æœˆè´¹ç”¨é¢„ä¼°ï¼š**
```
âœ… å¯¹è±¡å­˜å‚¨ï¼š0å…ƒï¼ˆåœ¨å…è´¹é¢åº¦å†…ï¼‰
âœ… å›¾ç‰‡å¤„ç†ï¼š0å…ƒï¼ˆåœ¨å…è´¹é¢åº¦å†…ï¼‰
âœ… CDNåŠ é€Ÿï¼š0å…ƒï¼ˆåœ¨å…è´¹é¢åº¦å†…ï¼‰

æ€»è®¡ï¼š0å…ƒ/æœˆ ğŸ‰
```

### ğŸ“ˆ **ä¸­å‹é¡¹ç›®ï¼ˆæœˆæ´»1000-5000ç”¨æˆ·ï¼‰**

**é¢„ä¼°ä½¿ç”¨é‡ï¼š**
- å­˜å‚¨ç©ºé—´ï¼š25GBï¼ˆçº¦25000å¼ æˆ·å‹å›¾ï¼‰
- æœˆä¸‹è½½æµé‡ï¼š30GB
- å›¾ç‰‡å¤„ç†ï¼š20ä¸‡æ¬¡/æœˆ
- CDNæµé‡ï¼š30GB

**æœˆè´¹ç”¨é¢„ä¼°ï¼š**
```
ğŸ“¦ å¯¹è±¡å­˜å‚¨ï¼š
   - å­˜å‚¨è´¹ï¼š(25-10) Ã— 0.148 = 2.22å…ƒ
   - æµé‡è´¹ï¼š(30-10) Ã— 0.29 = 5.8å…ƒ

ğŸ¨ å›¾ç‰‡å¤„ç†ï¼š
   - å¤„ç†è´¹ï¼š(20-10) Ã— 0.025 = 0.25å…ƒ

ğŸš€ CDNåŠ é€Ÿï¼š
   - æµé‡è´¹ï¼š(30-10) Ã— 0.24 = 4.8å…ƒ

æ€»è®¡ï¼šçº¦13å…ƒ/æœˆ ğŸ’°
```

### ğŸš€ **å¤§å‹é¡¹ç›®ï¼ˆæœˆæ´»>5000ç”¨æˆ·ï¼‰**

**é¢„ä¼°ä½¿ç”¨é‡ï¼š**
- å­˜å‚¨ç©ºé—´ï¼š100GBï¼ˆçº¦10ä¸‡å¼ æˆ·å‹å›¾ï¼‰
- æœˆä¸‹è½½æµé‡ï¼š200GB
- å›¾ç‰‡å¤„ç†ï¼š100ä¸‡æ¬¡/æœˆ
- CDNæµé‡ï¼š200GB

**æœˆè´¹ç”¨é¢„ä¼°ï¼š**
```
ğŸ“¦ å¯¹è±¡å­˜å‚¨ï¼š
   - å­˜å‚¨è´¹ï¼š(100-10) Ã— 0.148 = 13.32å…ƒ
   - æµé‡è´¹ï¼š(200-10) Ã— 0.29 = 55.1å…ƒ

ğŸ¨ å›¾ç‰‡å¤„ç†ï¼š
   - å¤„ç†è´¹ï¼š(100-10) Ã— 0.025 = 2.25å…ƒ

ğŸš€ CDNåŠ é€Ÿï¼š
   - æµé‡è´¹ï¼š200 Ã— 0.24 = 48å…ƒ

æ€»è®¡ï¼šçº¦119å…ƒ/æœˆ ğŸ’°
```

## ğŸ›’ è´­ä¹°æ­¥éª¤æŒ‡å—

### **ç¬¬ä¸€æ­¥ï¼šæ³¨å†Œå’Œå®åè®¤è¯**
1. è®¿é—® [ä¸ƒç‰›äº‘å®˜ç½‘](https://www.qiniu.com)
2. æ³¨å†Œè´¦å·å¹¶å®Œæˆå®åè®¤è¯
3. ç»‘å®šæ‰‹æœºå·å’Œé‚®ç®±

### **ç¬¬äºŒæ­¥ï¼šå¼€é€šå¯¹è±¡å­˜å‚¨æœåŠ¡**
1. è¿›å…¥æ§åˆ¶å° â†’ å¯¹è±¡å­˜å‚¨
2. åˆ›å»ºå­˜å‚¨ç©ºé—´ï¼ˆBucketï¼‰
   - **ç©ºé—´åç§°ï¼š** `rentpro-floor-plans`
   - **å­˜å‚¨åŒºåŸŸï¼š** åä¸œ-æµ™æ±Ÿï¼ˆæ¨èï¼Œå›½å†…è®¿é—®é€Ÿåº¦å¿«ï¼‰
   - **è®¿é—®æ§åˆ¶ï¼š** å…¬å¼€ç©ºé—´ï¼ˆä¾¿äºå›¾ç‰‡è®¿é—®ï¼‰
3. ç»‘å®šè‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼Œæ¨èï¼‰

### **ç¬¬ä¸‰æ­¥ï¼šå¼€é€šå›¾ç‰‡å¤„ç†æœåŠ¡**
1. åœ¨å­˜å‚¨ç©ºé—´è®¾ç½®ä¸­
2. å¼€å¯"å›¾ç‰‡æ ·å¼"åŠŸèƒ½
3. é…ç½®å¸¸ç”¨çš„å›¾ç‰‡å¤„ç†æ ·å¼ï¼š
   - `thumb`: ç¼©ç•¥å›¾ 200x150
   - `medium`: ä¸­ç­‰å°ºå¯¸ 800x600
   - `large`: å¤§å›¾ 1200x900

### **ç¬¬å››æ­¥ï¼šé…ç½®CDNåŠ é€Ÿï¼ˆæ¨èï¼‰**
1. è¿›å…¥æ§åˆ¶å° â†’ CDN
2. æ·»åŠ åŠ é€ŸåŸŸå
3. é…ç½®CNAMEè§£æ
4. å¼€å¯HTTPSï¼ˆå¦‚æœéœ€è¦ï¼‰

## ğŸ”§ æŠ€æœ¯é›†æˆ

### **Go SDKå®‰è£…**
```bash
go get github.com/qiniu/go-sdk/v7/storage
```

### **åŸºç¡€é…ç½®ä»£ç **
```go
package main

import (
    "context"
    "fmt"
    "github.com/qiniu/go-sdk/v7/auth/qbox"
    "github.com/qiniu/go-sdk/v7/storage"
)

// ä¸ƒç‰›äº‘é…ç½®
type QiniuConfig struct {
    AccessKey string
    SecretKey string
    Bucket    string
    Domain    string
}

// åˆå§‹åŒ–ä¸ƒç‰›äº‘å®¢æˆ·ç«¯
func NewQiniuClient(config QiniuConfig) *QiniuClient {
    mac := qbox.NewMac(config.AccessKey, config.SecretKey)
    
    cfg := storage.Config{
        Zone:          &storage.ZoneHuadong,    // åä¸œåŒºåŸŸ
        UseHTTPS:      true,                    // ä½¿ç”¨HTTPS
        UseCdnDomains: true,                    // ä½¿ç”¨CDNåŸŸå
    }
    
    return &QiniuClient{
        mac:    mac,
        config: cfg,
        bucket: config.Bucket,
        domain: config.Domain,
    }
}

type QiniuClient struct {
    mac    *qbox.Mac
    config storage.Config
    bucket string
    domain string
}

// ä¸Šä¼ æ–‡ä»¶
func (q *QiniuClient) UploadFile(localFile string, key string) (string, error) {
    uploader := storage.NewFormUploader(&q.config)
    ret := storage.PutRet{}
    
    // ç”Ÿæˆä¸Šä¼ Token
    putPolicy := storage.PutPolicy{
        Scope: q.bucket,
    }
    upToken := putPolicy.UploadToken(q.mac)
    
    // æ‰§è¡Œä¸Šä¼ 
    err := uploader.PutFile(context.Background(), &ret, upToken, key, localFile, nil)
    if err != nil {
        return "", err
    }
    
    // è¿”å›è®¿é—®URL
    return fmt.Sprintf("https://%s/%s", q.domain, key), nil
}

// ç”Ÿæˆå›¾ç‰‡å¤„ç†URL
func (q *QiniuClient) GetImageURL(key string, style string) string {
    baseURL := fmt.Sprintf("https://%s/%s", q.domain, key)
    if style != "" {
        return fmt.Sprintf("%s-%s", baseURL, style)
    }
    return baseURL
}
```

### **é›†æˆåˆ°ç°æœ‰é¡¹ç›®**
```go
// åœ¨ç°æœ‰çš„ä¸Šä¼ APIä¸­é›†æˆä¸ƒç‰›äº‘
api.POST("/upload/floor-plan", func(c *gin.Context) {
    // ... ç°æœ‰çš„éªŒè¯é€»è¾‘ ...
    
    // ä¿å­˜åˆ°æœ¬åœ°ä¸´æ—¶æ–‡ä»¶
    tempFile := filepath.Join("/tmp", fileName)
    c.SaveUploadedFile(file, tempFile)
    defer os.Remove(tempFile) // æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    
    // ä¸Šä¼ åˆ°ä¸ƒç‰›äº‘
    qiniuKey := fmt.Sprintf("floor-plans/%s", fileName)
    imageURL, err := qiniuClient.UploadFile(tempFile, qiniuKey)
    if err != nil {
        c.JSON(http.StatusInternalServerError, gin.H{
            "code":    500,
            "message": "ä¸Šä¼ åˆ°ä¸ƒç‰›äº‘å¤±è´¥",
            "error":   err.Error(),
        })
        return
    }
    
    // ç”Ÿæˆä¸åŒå°ºå¯¸çš„URL
    thumbnailURL := qiniuClient.GetImageURL(qiniuKey, "thumb")
    mediumURL := qiniuClient.GetImageURL(qiniuKey, "medium")
    
    // æ›´æ–°æ•°æ®åº“
    database.DB.Model(&houseType).Updates(map[string]interface{}{
        "floor_plan_url": imageURL,
        "floor_plan_thumbnail_url": thumbnailURL,
        "floor_plan_medium_url": mediumURL,
    })
    
    c.JSON(http.StatusOK, gin.H{
        "code":    200,
        "message": "æˆ·å‹å›¾ä¸Šä¼ æˆåŠŸ",
        "data": gin.H{
            "original_url":  imageURL,
            "thumbnail_url": thumbnailURL,
            "medium_url":    mediumURL,
        },
    })
})
```

## ğŸ¨ å›¾ç‰‡å¤„ç†æ ·å¼é…ç½®

### **åœ¨ä¸ƒç‰›äº‘æ§åˆ¶å°é…ç½®æ ·å¼**

1. **ç¼©ç•¥å›¾æ ·å¼ (thumb)**
   ```
   imageView2/1/w/200/h/150/q/85/format/jpg
   ```

2. **ä¸­ç­‰å°ºå¯¸æ ·å¼ (medium)**
   ```
   imageView2/1/w/800/h/600/q/85/format/jpg
   ```

3. **å¤§å›¾æ ·å¼ (large)**
   ```
   imageView2/1/w/1200/h/900/q/90/format/jpg
   ```

### **å‰ç«¯ä½¿ç”¨ç¤ºä¾‹**
```vue
<template>
  <!-- åˆ—è¡¨é¡µç¼©ç•¥å›¾ -->
  <el-image :src="row.floor_plan_url + '-thumb'" />
  
  <!-- è¯¦æƒ…é¡µä¸­ç­‰å›¾ç‰‡ -->
  <el-image :src="houseType.floor_plan_url + '-medium'" />
  
  <!-- é¢„è§ˆå¤§å›¾ -->
  <el-image 
    :src="houseType.floor_plan_url + '-medium'"
    :preview-src-list="[houseType.floor_plan_url + '-large']"
  />
</template>
```

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

### **1. æˆæœ¬ä¼˜åŒ–**
- ğŸ†“ **å……åˆ†åˆ©ç”¨å…è´¹é¢åº¦** - å°é¡¹ç›®å®Œå…¨å…è´¹
- ğŸ“¦ **åˆç†è§„åˆ’å­˜å‚¨** - å®šæœŸæ¸…ç†æ— ç”¨å›¾ç‰‡
- ğŸ—œï¸ **ä½¿ç”¨å›¾ç‰‡å‹ç¼©** - å‡å°‘å­˜å‚¨å’Œæµé‡æˆæœ¬

### **2. æ€§èƒ½ä¼˜åŒ–**
- ğŸš€ **å¯ç”¨CDNåŠ é€Ÿ** - æå‡å…¨çƒè®¿é—®é€Ÿåº¦
- ğŸ¨ **é…ç½®å›¾ç‰‡æ ·å¼** - æŒ‰éœ€åŠ è½½ä¸åŒå°ºå¯¸
- ğŸ“± **WebPæ ¼å¼æ”¯æŒ** - ç°ä»£æµè§ˆå™¨ä¼˜åŒ–

### **3. å®‰å…¨å»ºè®®**
- ğŸ” **AccessKeyå®‰å…¨** - ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨
- ğŸŒ **åŸŸåç»‘å®š** - ä½¿ç”¨è‡ªå·±çš„åŸŸå
- ğŸ”’ **HTTPSé…ç½®** - ç¡®ä¿ä¼ è¾“å®‰å…¨

## ğŸ‰ æ€»ç»“

### âœ… **æ¨èè´­ä¹°æ¸…å•**
1. **å¯¹è±¡å­˜å‚¨ Kodo** - å¿…é€‰ï¼ŒåŸºç¡€å­˜å‚¨æœåŠ¡
2. **æ™ºèƒ½å¤šåª’ä½“æœåŠ¡ DORA** - æ¨èï¼Œå›¾ç‰‡å¤„ç†åŠŸèƒ½
3. **CDNåŠ é€ŸæœåŠ¡** - æ¨èï¼Œæå‡è®¿é—®é€Ÿåº¦

### ğŸ’° **æˆæœ¬ä¼˜åŠ¿**
- **å°é¡¹ç›®å®Œå…¨å…è´¹** - æœˆå…è´¹é¢åº¦è¶³å¤Ÿä½¿ç”¨
- **æŒ‰éœ€ä»˜è´¹** - ç”¨å¤šå°‘ä»˜å¤šå°‘ï¼Œæ— æµªè´¹
- **ä»·æ ¼é€æ˜** - æ— éšè—è´¹ç”¨

### ğŸš€ **æŠ€æœ¯ä¼˜åŠ¿**
- **Go SDKå®Œå–„** - é›†æˆç®€å•
- **å›¾ç‰‡å¤„ç†å¼ºå¤§** - å®æ—¶å¤„ç†ï¼Œæ— éœ€é¢„ç”Ÿæˆ
- **CDNå…¨çƒåŠ é€Ÿ** - è®¿é—®é€Ÿåº¦å¿«

**å¯¹äºæ‚¨çš„æˆ·å‹å›¾ç®¡ç†é¡¹ç›®ï¼Œå»ºè®®ä»å…è´¹é¢åº¦å¼€å§‹ä½¿ç”¨ï¼Œéšç€ä¸šåŠ¡å¢é•¿å†è€ƒè™‘ä»˜è´¹ï¼** ğŸ¨âœ¨
