# 新增户型功能字段设计分析

**创建时间：** 2024年12月
**功能模块：** 户型管理
**开发阶段：** 需求分析

## 📋 字段分类设计

### 🔴 **必填字段 (Required Fields)**

#### **1. 基础标识字段**
- **`name`** - 户型名称
  - **类型：** varchar(100)
  - **示例：** "经典一居"、"舒适两居"、"宽敞三居"
  - **验证：** 不能为空，长度1-100字符
  - **业务意义：** 户型的主要标识，用户最关注的信息

- **`code`** - 户型编码
  - **类型：** varchar(50)
  - **示例：** "A1"、"B2"、"C3"
  - **验证：** 不能为空，同一楼盘内唯一
  - **业务意义：** 内部管理标识，便于系统识别和管理

- **`building_id`** - 所属楼盘ID
  - **类型：** bigint unsigned
  - **验证：** 必须是有效的楼盘ID
  - **业务意义：** 关联关系，确定户型归属

#### **2. 核心规格字段**
- **`standard_area`** - 标准建筑面积
  - **类型：** decimal(8,2)
  - **示例：** 45.50, 78.50, 108.00
  - **验证：** 大于0，最多8位数字，2位小数
  - **业务意义：** 户型最重要的物理属性，影响价格计算

- **`rooms`** - 房间数
  - **类型：** bigint
  - **默认值：** 1
  - **验证：** 大于等于1
  - **业务意义：** 户型布局核心信息

- **`halls`** - 客厅数
  - **类型：** bigint
  - **默认值：** 1
  - **验证：** 大于等于1
  - **业务意义：** 户型布局核心信息

- **`bathrooms`** - 卫生间数
  - **类型：** bigint
  - **默认值：** 1
  - **验证：** 大于等于1
  - **业务意义：** 户型布局核心信息

### 🟡 **建议填写字段 (Recommended Fields)**

#### **1. 描述信息**
- **`description`** - 户型描述
  - **类型：** text
  - **示例：** "精致一居室，适合单身人士"
  - **业务意义：** 营销描述，提升用户体验

#### **2. 价格信息**
- **`base_sale_price`** - 基准售价
  - **类型：** decimal(12,2)
  - **示例：** 800000.00
  - **业务意义：** 核心商业信息，但可能需要后续评估确定

- **`base_rent_price`** - 基准租金
  - **类型：** decimal(8,2)
  - **示例：** 3500.00
  - **业务意义：** 租赁业务核心信息

### 🟢 **选填字段 (Optional Fields)**

#### **1. 扩展规格信息**
- **`balconies`** - 阳台数
  - **类型：** bigint
  - **默认值：** 0
  - **业务意义：** 户型附加信息

- **`floor_height`** - 层高
  - **类型：** decimal(4,2)
  - **示例：** 2.80
  - **业务意义：** 详细规格信息

#### **2. 朝向景观**
- **`standard_orientation`** - 标准朝向
  - **类型：** varchar(50)
  - **示例：** "南向"、"南北"
  - **业务意义：** 影响居住体验的重要因素

- **`standard_view`** - 标准景观
  - **类型：** varchar(100)
  - **示例：** "小区景观"、"城市景观"
  - **业务意义：** 影响房屋价值的因素

#### **3. 价格单价（自动计算）**
- **`base_sale_price_per`** - 基准售价单价
  - **类型：** decimal(8,2)
  - **计算公式：** base_sale_price / standard_area
  - **业务意义：** 便于价格比较

- **`base_rent_price_per`** - 基准租金单价
  - **类型：** decimal(6,2)
  - **计算公式：** base_rent_price / standard_area
  - **业务意义：** 便于租金比较

#### **4. 状态管理**
- **`status`** - 状态
  - **类型：** varchar(20)
  - **默认值：** 'active'
  - **选项：** active, inactive, pending
  - **业务意义：** 户型生命周期管理

- **`is_hot`** - 是否热门户型
  - **类型：** tinyint(1)
  - **默认值：** 0
  - **业务意义：** 营销标记

#### **5. 图片资源**
- **`main_image`** - 主图URL
  - **类型：** varchar(500)
  - **业务意义：** 户型展示图片

- **`floor_plan_url`** - 户型图URL
  - **类型：** varchar(500)
  - **业务意义：** 户型平面图

- **`image_urls`** - 图片URL列表
  - **类型：** json
  - **业务意义：** 户型相关图片集合

- **`tags`** - 标签
  - **类型：** json
  - **示例：** ["精装修", "南北通透", "采光好"]
  - **业务意义：** 户型特色标签

### 🚫 **系统自动处理字段**

#### **1. 库存统计（初始为0，后续自动计算）**
- `total_stock` - 总库存
- `available_stock` - 可用库存
- `sold_stock` - 已售库存
- `rented_stock` - 已租库存
- `reserved_stock` - 预订库存

#### **2. 审计字段（系统自动填充）**
- `created_by` - 创建人
- `updated_by` - 更新人
- `created_at` - 创建时间
- `updated_at` - 更新时间
- `deleted_at` - 删除时间

## 🎨 **表单设计建议**

### **第一步：基础信息（必填）**
```
┌─ 户型基础信息 ─────────────────────┐
│ 户型名称: [__________________] *   │
│ 户型编码: [__________________] *   │
│ 所属楼盘: [下拉选择____________] *   │
│ 建筑面积: [__________________] * ㎡│
└─────────────────────────────────────┘
```

### **第二步：户型布局（必填）**
```
┌─ 户型布局 ─────────────────────────┐
│ 房间数: [▼] 室 *  客厅数: [▼] 厅 * │
│ 卫生间: [▼] 卫 *  阳台数: [▼] 个   │
│ 层高: [__________] 米              │
└─────────────────────────────────────┘
```

### **第三步：价格信息（建议填写）**
```
┌─ 价格信息 ─────────────────────────┐
│ 基准售价: [__________________] 元  │
│ 基准租金: [__________________] 元/月│
│ □ 自动计算单价                     │
└─────────────────────────────────────┘
```

### **第四步：扩展信息（选填）**
```
┌─ 扩展信息 ─────────────────────────┐
│ 朝向: [__________________]        │
│ 景观: [__________________]        │
│ 户型描述:                          │
│ [________________________________] │
│ [________________________________] │
│ 状态: [▼] 是否热门: □              │
└─────────────────────────────────────┘
```

## 🔧 **表单验证规则**

### **前端验证**
```typescript
const rules = {
  name: [
    { required: true, message: '请输入户型名称', trigger: 'blur' },
    { min: 1, max: 100, message: '户型名称长度为1-100个字符', trigger: 'blur' }
  ],
  code: [
    { required: true, message: '请输入户型编码', trigger: 'blur' },
    { pattern: /^[A-Z0-9]+$/, message: '户型编码只能包含大写字母和数字', trigger: 'blur' }
  ],
  building_id: [
    { required: true, message: '请选择所属楼盘', trigger: 'change' }
  ],
  standard_area: [
    { required: true, message: '请输入建筑面积', trigger: 'blur' },
    { type: 'number', min: 0.01, message: '建筑面积必须大于0', trigger: 'blur' }
  ],
  rooms: [
    { required: true, message: '请选择房间数', trigger: 'change' },
    { type: 'integer', min: 1, message: '房间数必须大于等于1', trigger: 'change' }
  ]
}
```

### **后端验证**
```go
type CreateHouseTypeRequest struct {
    Name         string  `json:"name" binding:"required,min=1,max=100"`
    Code         string  `json:"code" binding:"required,max=50"`
    BuildingID   uint    `json:"building_id" binding:"required,gt=0"`
    StandardArea float64 `json:"standard_area" binding:"required,gt=0"`
    Rooms        int     `json:"rooms" binding:"required,gte=1"`
    Halls        int     `json:"halls" binding:"required,gte=1"`
    Bathrooms    int     `json:"bathrooms" binding:"required,gte=1"`
    // 选填字段...
}
```

## 💡 **业务逻辑建议**

### **1. 编码唯一性检查**
- 同一楼盘内户型编码不能重复
- 建议格式：字母+数字组合（如A1, B2, C3）

### **2. 价格单价自动计算**
- 如果填写了基准价格，自动计算单价
- 提供单价显示和验证

### **3. 默认值设置**
- 房间数、客厅数、卫生间数默认为1
- 阳台数默认为0
- 状态默认为active
- 是否热门默认为false

### **4. 数据完整性**
- 确保关联的楼盘存在且有效
- 验证面积数据的合理性

这样的设计既保证了核心业务数据的完整性，又为用户提供了灵活的录入体验。您觉得这个字段分类合理吗？需要调整哪些部分？
