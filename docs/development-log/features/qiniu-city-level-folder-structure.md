# ä¸ƒç‰›äº‘åŸå¸‚çº§åˆ«æ–‡ä»¶å¤¹ç»“æ„ä¼˜åŒ–

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ä¸ºäº†æ›´å¥½åœ°ç»„ç»‡å’Œç®¡ç†ä¸ƒç‰›äº‘å­˜å‚¨ä¸­çš„æ¥¼ç›˜æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼˜åŒ–äº†æ–‡ä»¶å¤¹ç»“æ„ï¼Œå¼•å…¥äº†åŸå¸‚çº§åˆ«çš„åˆ†å±‚ç®¡ç†ã€‚

## ğŸ”„ æ”¹è¿›å‰åå¯¹æ¯”

### æ”¹è¿›å‰çš„æ–‡ä»¶å¤¹ç»“æ„
```
buildings/
  â”œâ”€â”€ 1-æ¥¼ç›˜A/
  â”‚   â”œâ”€â”€ floor-plans/
  â”‚   â”œâ”€â”€ site-plans/
  â”‚   â””â”€â”€ ...
  â”œâ”€â”€ 2-æ¥¼ç›˜B/
  â”‚   â”œâ”€â”€ floor-plans/
  â”‚   â”œâ”€â”€ site-plans/
  â”‚   â””â”€â”€ ...
  â””â”€â”€ ...
```

### æ”¹è¿›åçš„æ–‡ä»¶å¤¹ç»“æ„
```
buildings/
  â”œâ”€â”€ åŒ—äº¬/
  â”‚   â”œâ”€â”€ 1-æ¥¼ç›˜A/
  â”‚   â”‚   â”œâ”€â”€ floor-plans/
  â”‚   â”‚   â”œâ”€â”€ site-plans/
  â”‚   â”‚   â”œâ”€â”€ environment/
  â”‚   â”‚   â”œâ”€â”€ building-images/
  â”‚   â”‚   â”œâ”€â”€ interior/
  â”‚   â”‚   â”œâ”€â”€ facilities/
  â”‚   â”‚   â””â”€â”€ documents/
  â”‚   â””â”€â”€ 2-æ¥¼ç›˜B/
  â”‚       â””â”€â”€ ...
  â”œâ”€â”€ ä¸Šæµ·/
  â”‚   â”œâ”€â”€ 3-æ¥¼ç›˜C/
  â”‚   â”‚   â””â”€â”€ ...
  â”‚   â””â”€â”€ ...
  â”œâ”€â”€ å¹¿å·/
  â”‚   â””â”€â”€ ...
  â””â”€â”€ æ·±åœ³/
      â””â”€â”€ ...
```

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### 1. æ•°æ®æ¨¡å‹æ›´æ–°

ä¿®æ”¹äº† `CreateBuildingFolder` å‡½æ•°ï¼Œä»æ•°æ®åº“è·å–æ¥¼ç›˜çš„åŸå¸‚ä¿¡æ¯ï¼š

```go
// è·å–æ¥¼ç›˜ä¿¡æ¯åŒ…æ‹¬åŸå¸‚
var building struct {
    ID   uint64 `json:"id"`
    Name string `json:"name"`
    City string `json:"city"`
}

if err := im.db.Table("sys_buildings").
    Select("id, name, city").
    Where("id = ?", buildingID).
    First(&building).Error; err != nil {
    return fmt.Errorf("è·å–æ¥¼ç›˜ä¿¡æ¯å¤±è´¥: %v", err)
}
```

### 2. æ–‡ä»¶å¤¹è·¯å¾„ç”Ÿæˆ

æ›´æ–°äº† `createQiniuFolderStructure` å‡½æ•°ç­¾åå’Œå®ç°ï¼š

```go
// ä¿®æ”¹å‰
func (im *ImageManager) createQiniuFolderStructure(buildingID uint64, buildingName string, folders map[string]string) error

// ä¿®æ”¹å
func (im *ImageManager) createQiniuFolderStructure(buildingID uint64, buildingName, cityName string, folders map[string]string) error
```

### 3. ä¸ƒç‰›äº‘è·¯å¾„æ„å»º

æ–°çš„æ–‡ä»¶å¤¹è·¯å¾„æ„å»ºé€»è¾‘ï¼š

```go
// å¤„ç†åŸå¸‚åç§°å’Œæ¥¼ç›˜åç§°ï¼Œç¡®ä¿é€‚åˆä½œä¸ºæ–‡ä»¶å¤¹åç§°
safeCityName := im.sanitizeFolderName(cityName)
safeBuildingName := im.sanitizeFolderName(buildingName)
buildingFolderName := fmt.Sprintf("%d-%s", buildingID, safeBuildingName)

// åˆ›å»ºæ–‡ä»¶å¤¹æ ‡è®°æ–‡ä»¶çš„keyï¼Œä½¿ç”¨åŸå¸‚/æ¥¼ç›˜/å­æ–‡ä»¶å¤¹çš„å±‚çº§ç»“æ„
folderKey := fmt.Sprintf("buildings/%s/%s/%s/.folder", safeCityName, buildingFolderName, folder)
```

### 4. æ ‡è®°æ–‡ä»¶å†…å®¹å¢å¼º

æ ‡è®°æ–‡ä»¶ç°åœ¨åŒ…å«æ›´å¤šä¿¡æ¯ï¼š

```json
{
  "building_id": 18,
  "building_name": "æ·±åœ³æµ‹è¯•æ¥¼ç›˜",
  "city_name": "æ·±åœ³",
  "building_folder_name": "18-æ·±åœ³æµ‹è¯•æ¥¼ç›˜",
  "folder_type": "floor-plans",
  "description": "æˆ·å‹å›¾",
  "folder_path": "buildings/æ·±åœ³/18-æ·±åœ³æµ‹è¯•æ¥¼ç›˜/floor-plans/",
  "created_at": "2025-09-05 17:30:15",
  "purpose": "This file marks the existence of this folder structure with city-level organization"
}
```

## âœ… åŠŸèƒ½ä¼˜åŠ¿

### 1. æ›´å¥½çš„æ–‡ä»¶ç»„ç»‡
- **åŸå¸‚çº§åˆ«åˆ†ç±»**ï¼šæŒ‰åŸå¸‚å¯¹æ¥¼ç›˜è¿›è¡Œåˆ†ç»„ï¼Œä¾¿äºç®¡ç†
- **æ¸…æ™°çš„å±‚çº§ç»“æ„**ï¼šåŸå¸‚ â†’ æ¥¼ç›˜ â†’ æ–‡ä»¶ç±»å‹çš„ä¸‰çº§ç»“æ„
- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒæ›´å¤šåŸå¸‚çš„æ— ç¼æ‰©å±•

### 2. æå‡ç®¡ç†æ•ˆç‡
- **å¿«é€Ÿå®šä½**ï¼šå¯ä»¥å¿«é€Ÿå®šä½åˆ°ç‰¹å®šåŸå¸‚çš„æ¥¼ç›˜æ–‡ä»¶
- **æ‰¹é‡æ“ä½œ**ï¼šå¯ä»¥æŒ‰åŸå¸‚è¿›è¡Œæ‰¹é‡æ–‡ä»¶æ“ä½œ
- **æƒé™ç®¡ç†**ï¼šæœªæ¥å¯ä»¥åŸºäºåŸå¸‚è¿›è¡Œæƒé™åˆ†é…

### 3. å­˜å‚¨ä¼˜åŒ–
- **é€»è¾‘åˆ†åŒº**ï¼šä¸åŒåŸå¸‚çš„æ–‡ä»¶é€»è¾‘åˆ†ç¦»
- **å‡å°‘å†²çª**ï¼šé™ä½åŒåæ¥¼ç›˜çš„æ–‡ä»¶å¤¹å†²çªæ¦‚ç‡
- **ä¾¿äºå¤‡ä»½**ï¼šå¯ä»¥æŒ‰åŸå¸‚è¿›è¡Œåˆ†åˆ«å¤‡ä»½

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•ç”¨ä¾‹

1. **æ·±åœ³æ¥¼ç›˜æµ‹è¯•**
   ```bash
   curl -X POST "http://localhost:8002/api/v1/buildings" \
     -H "Content-Type: application/json" \
     -d '{
       "name": "æ·±åœ³æµ‹è¯•æ¥¼ç›˜",
       "city": "æ·±åœ³",
       "district": "ç¦ç”°åŒº",
       "businessArea": "åå¼ºåŒ—å•†åœˆ",
       "propertyType": "ä½å®…",
       "description": "æµ‹è¯•åŸå¸‚çº§åˆ«æ–‡ä»¶å¤¹ç»“æ„",
       "status": "active"
     }'
   ```

2. **å¹¿å·æ¥¼ç›˜æµ‹è¯•**
   ```bash
   curl -X POST "http://localhost:8002/api/v1/buildings" \
     -H "Content-Type: application/json" \
     -d '{
       "name": "å¹¿å·æµ‹è¯•æ¥¼ç›˜",
       "city": "å¹¿å·",
       "district": "å¤©æ²³åŒº",
       "businessArea": "å¤©æ²³åŸå•†åœˆ",
       "propertyType": "åŠå…¬",
       "description": "æµ‹è¯•å¹¿å·åŸå¸‚æ–‡ä»¶å¤¹ç»“æ„",
       "status": "active"
     }'
   ```

### éªŒè¯ç»“æœ

âœ… æˆåŠŸåˆ›å»ºåŸå¸‚çº§åˆ«çš„æ–‡ä»¶å¤¹ç»“æ„ï¼š
- `buildings/æ·±åœ³/18-æ·±åœ³æµ‹è¯•æ¥¼ç›˜/`
- `buildings/å¹¿å·/19-å¹¿å·æµ‹è¯•æ¥¼ç›˜/`

æ¯ä¸ªæ¥¼ç›˜æ–‡ä»¶å¤¹ä¸‹åŒ…å«å®Œæ•´çš„å­æ–‡ä»¶å¤¹ï¼š
- `floor-plans/` (æˆ·å‹å›¾)
- `site-plans/` (å°åŒºå¹³é¢å›¾)
- `environment/` (å°åŒºç¯å¢ƒå›¾)
- `building-images/` (æ¥¼ç›˜å¤–è§‚å›¾)
- `interior/` (å®¤å†…æ ·æ¿å›¾)
- `facilities/` (é…å¥—è®¾æ–½å›¾)
- `documents/` (ç›¸å…³æ–‡æ¡£)

## ğŸ”® æœªæ¥æ‰©å±•

### 1. åŒºåŸŸçº§åˆ«ç»†åˆ†
å¯ä»¥è¿›ä¸€æ­¥ç»†åˆ†åˆ°åŒºåŸŸçº§åˆ«ï¼š
```
buildings/
  â”œâ”€â”€ åŒ—äº¬/
  â”‚   â”œâ”€â”€ æœé˜³åŒº/
  â”‚   â”œâ”€â”€ æµ·æ·€åŒº/
  â”‚   â””â”€â”€ ...
  â””â”€â”€ ...
```

### 2. æ–‡ä»¶ç±»å‹æ ‡ç­¾
ä¸ºä¸åŒç±»å‹çš„æ–‡ä»¶æ·»åŠ æ›´è¯¦ç»†çš„æ ‡ç­¾å’Œåˆ†ç±»ã€‚

### 3. è‡ªåŠ¨æ¸…ç†æœºåˆ¶
å®ç°è¿‡æœŸæˆ–æ— ç”¨æ–‡ä»¶çš„è‡ªåŠ¨æ¸…ç†æœºåˆ¶ã€‚

## ğŸ“… å®æ–½æ—¥æœŸ
2025å¹´9æœˆ5æ—¥

## ğŸ‘¥ ç›¸å…³äººå‘˜
- å¼€å‘è€…ï¼šAI Assistant
- æµ‹è¯•éªŒè¯ï¼šå®Œæˆ

## ğŸ·ï¸ æ ‡ç­¾
`ä¸ƒç‰›äº‘` `æ–‡ä»¶ç®¡ç†` `åŸå¸‚åˆ†çº§` `å­˜å‚¨ä¼˜åŒ–` `æ¥¼ç›˜ç®¡ç†`
